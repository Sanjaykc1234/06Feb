name: terraform-pipeline
trigger: none

pool:
  name: Vinod  

jobs:
- job: terraform_all
  displayName: Terraform Init Plan Apply

  steps:
  - checkout: self

  - task: TerraformTask@5
    displayName: Terraform Init
    inputs:
      provider: 'azurerm'
      command: 'init'
      commandOptions: '-reconfigure -upgrade'
      backendServiceArm: 'vinodsvc'
      backendAzureRmResourceGroupName: 'rg-ksanjay'
      backendAzureRmStorageAccountName: 'stgksanjay'
      backendAzureRmContainerName: 'contksanjay'
      backendAzureRmKey: 'self.tfstate'


  - task: TerraformTask@5
    displayName: Terraform Plan
    inputs:
      provider: 'azurerm'
      command: 'plan'
      environmentServiceNameAzureRM: 'vinodsvc'


  - task: TerraformTask@5
    displayName: Terraform Apply
    inputs:
      provider: 'azurerm'
      command: 'apply'
      commandOptions: '-auto-approve'
      environmentServiceNameAzureRM: 'vinodsvc'
